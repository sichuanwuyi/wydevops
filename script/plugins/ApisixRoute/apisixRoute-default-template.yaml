{{- range \$.Values.${l_moduleName}.gatewayRoute.routes }}

---
apiVersion: apisix.apache.org/${l_gatewayVersion}
kind: ApisixRoute
metadata:
  namespace: {{ \$.Release.Namespace }}
  name: {{ .name | trunc 63 | trimSuffix \"-\" }}
spec:
  http:
    - name: {{ .name | trunc 57 | trimSuffix \"-\" }}-route
      {{- if .websocket }}
      websocket: {{ .websocket }}
      {{- end }}
      match:
        {{- with .match}}
          {{- if .hosts }}
          hosts:
            {{- range .hosts }}
            - {{ . | quote }}
            {{- end }}
          {{ else if \$.Values.devApisixHosts }}
          hosts:
            - {{ \$.Values.devApisixHosts | quote }}
          {{- end }}
          paths:
            {{- range .paths }}
            - {{ . | quote }}
            {{- end }}
        {{- end }}
      {{- if .timeout }}
      timeout:
        {{- toYaml .timeout | nindent 8 }}
      {{- end }}
      {{- if .plugins }}
      plugins:
        {{- toYaml .plugins | nindent 8 }}
      {{- end }}
      backends:
        - serviceName: {{ .name | trunc 63 | trimSuffix \"-\" }}
          {{- with .backends }}
          servicePort: {{ .servicePort }}
          {{- end }}
{{- end }}
